<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merkle Tree Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #output {
            margin-top: 20px;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border: 1px solid #ddd;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Merkle Tree Generator</h1>
    <p>Sube un archivo CSV con una lista de direcciones de wallets:</p>
    <input type="file" id="fileInput">
    <div id="output"></div>

    <script>
        document.getElementById('fileInput').addEventListener('change', handleFileSelect, false);

        function handleFileSelect(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const addresses = text.split(/\r?\n/).filter(line => line.trim() !== '');
                if (addresses.length === 0) {
                    document.getElementById('output').innerText = 'El archivo CSV está vacío o no contiene direcciones válidas.';
                    return;
                }
                const merkleTree = createMerkleTree(addresses);
                document.getElementById('output').innerHTML = `<h2>Árbol de Merkle:</h2><pre>${JSON.stringify(merkleTree, null, 2)}</pre>`;
            };
            reader.readAsText(file);
        }

        function createMerkleTree(leaves) {
            if (leaves.length === 0) return [];
            if (leaves.length === 1) return leaves;
            const newLevel = [];
            for (let i = 0; i < leaves.length; i += 2) {
                if (i + 1 < leaves.length) {
                    newLevel.push(hash(leaves[i] + leaves[i + 1]));
                } else {
                    newLevel.push(leaves[i]);
                }
            }
            return [newLevel, ...createMerkleTree(newLevel)];
        }

        function hash(data) {
            return CryptoJS.SHA256(data).toString(CryptoJS.enc.Hex);
        }

        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js';
        document.head.appendChild(script);
    </script>
</body>
</html>
